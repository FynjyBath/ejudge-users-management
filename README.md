# ejudge-users-management

Утилита командной строки для пакетного управления регистрациями пользователей в Ejudge через REST API.

## Сборка

```bash
go build -o ejudge-users ./cmd/ejudge-users
```

## Запуск

```bash
./ejudge-users \
  -config config.json \
  -users "login1:Иван Иванов;login2:Пётр Петров" \
  -contests "101;102;103" \
  -action register \
  -base-url "https://ejudge.example.org"
```

Файл `config.json` хранит чувствительные данные, такие как токен авторизации. Это позволяет избежать передачи токена напрямую в командной строке.

```json
{
  "token": "Bearer <API_TOKEN>"
}
```

Также допустимо указывать только значение токена без префикса (например, `"token": "AQAA..."`).
Утилита автоматически добавит схему `Bearer`, если строка не содержит иного значения заголовка `Authorization`.

Аргументы:

* `-users` — список логинов и отображаемых имён через `;` или `,`. Каждая запись имеет формат `<логин или id>:<отображаемое имя>`. Если вместо логина указан числовой идентификатор, он будет передан в API в параметре `other_user_id`.
* `-contests` — список идентификаторов контестов через `;` или `,`.
* `-action` — `register` (значение по умолчанию) или `unregister`.
* `-base-url` — базовый URL установки Ejudge. По умолчанию `http://localhost`.
* `-token` — значение заголовка `Authorization`. Обычно Ejudge ожидает строку вида `Bearer <токен>`. Значение из флага имеет приоритет над записью в конфигурационном файле.
* `-config` — путь к JSON-файлу с настройками (в том числе `token`).
* `-timeout` — таймаут каждого HTTP-запроса (Go duration, например `30s`).
* `-insecure` — отключить проверку TLS-сертификата (используйте только для отладки!).

При действии `register` утилита вызывает `/ej/api/v1/master/change-registration` с операцией `upsert`, устанавливая статус `ok` и заданное отображаемое имя пользователя. При `unregister` вызывается та же точка с операцией `delete`.

Утилита завершится с кодом 1, если хотя бы одна операция завершилась ошибкой. Подробности выводятся в стандартный вывод.
